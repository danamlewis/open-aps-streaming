
{% extends "layout.html" %}
{% block content %}


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/flatpickr.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/themes/dark.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.2.3/flatpickr.js"></script>



<style>

    .message-box, .admin-forms {
        position: absolute;
        left: 3%;
        padding-left: 2%;
        }

    .message-box {
        top: 120px;
        height: 6%;
        width: 35%;
        }
    .admin-forms {
        width: 90%;
        max-width: 600px;
        top: calc(8% + 120px);
        }

    .select2-selection__arrow b{
        display:none !important;
    }

    .admin-forms h6 {
        margin-bottom: 4%;
        margin-top: 7%;
        }

    .user-select, .enter-user {
        font-size: 14px;
        padding-left: 8px;
        background-color: rgba(15, 17, 22, 0.8);
        color: #d6d6d6;
        line-height: 38px;
        font-size: 1rem;
        width: 70%;
        }
    .select2-selection--single {width: 100%;}

    .enter-user, .select2-container, .select2-selection--single, .select2-container--default {
        float: left;
        height: 40px !important;
        border: 1px solid rgba(250,250,250,0.2);
        border-radius: 3px;
        }
    .enter-user, .select2-container {box-shadow: inset 0 0 1em rgba(0, 170, 170, 0.2), 0 0 1em rgba(0, 170, 170, 0.2);}
    .enter-user:hover, .select2-container:hover {box-shadow: inset 0 0 1em rgba(0, 170, 170, 0.5), 0 0 1em rgba(0, 170, 170, 0.5);}


    .select2-container--default .select2-selection--single {background-color: transparent; border: none;}
    .select2-results {background-color: rgba(15, 17, 22, 0.8); color: #d6d6d6;}
    .select2-container--default .select2-selection--single .select2-selection__rendered {color: #d6d6d6 !important; line-height: 38px;}
    .select2-search, .select2-search--dropdown {background-color: rgba(15, 17, 22, 0.8);}
    .select2-search__field {color: #d6d6d6; background: rgba(15, 17, 22, 0.8);}


    .title-hr {margin-left: 0%;}
    .title-text {padding-left: 0%;}

    .admin-button {float: left; margin-left: 2%; width: 28%;}

    .metrics-button {
        width: 40%;
        margin-top: 10%;
        }

</style>




<div class="background-content">

    <img src="{{ url_for('static', filename='images/background/' + 'base_v4.jpg') }}" width="100%">

    <div class="message-box unselectable">

        <div class="title-text">ADMIN</div>
        <div class="title-hr"></div>

    </div>

    <div class="admin-forms">

        <form method="POST">
            <h6>Add User</h6>
            <input class="enter-user" name="add-user" placeholder="Enter user email.." spellcheck="false" required>
            <span class="fuller-button admin-button">ADD</span>
        </form>

        <br>

        <form method="POST">
            <h6>Remove User</h6>
            <select class="user-select" name="remove-user" required>
                <option selected disabled></option>
            </select>
            <span class="fuller-button admin-button">REMOVE</span>
        </form>

        <br>

        <div class="fuller-button metrics-button">USER METRICS</div>

    </div>


</div>


<link href="{{ url_for('static', filename='css/' + 'table.css') }}" rel="stylesheet">

<style>

    .users-overlay {
        position:absolute;
        top: 11%;
        left: 50%;
        transform: translateX(-50%);
        height: 70%;
        padding-bottom: 2px;
        width: 75%;
        max-width: 1400px;
        background-color: rgba(15, 17, 22, 1.0);
        padding: 0.5%;
        border-radius: 5px;
        box-shadow: inset 0 0 0.5em rgba(0, 170, 170, 0.2), 0 0 0.5em rgba(0, 170, 170, 0.2);
        text-align: center;
        display: none;
        }

    table th, table td {text-align: center; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;}

    .email-col, .email-head {width: 30%;}

    .downloads-col, .down-size-col, .login-cnt-col,
    .downloads-head, .down-size-head, .login-cnt-head {
        width: 16.3%;
        }

    .last-login-col, .last-login-head {width: 20%;}

    h4 {margin-bottom: 15px; margin-top: 20px;}

    .close-button {
        position: absolute;
        top: 2%; right: 2%;
        cursor: pointer;
        color: rgba(250,250,250,0.8);
        font-size: 13px;
        }
    .close-button:hover {
        text-decoration: underline;
        color: rgb(0, 93, 242);
        }

</style>

<div class="users-overlay unselectable">
      <h4>User Metrics</h4>
      <div class="close-button">Close</div>
      <div class="tbl-header">
        <table cellpadding="0" cellspacing="0" border="0">
          <thead>
            <tr>
              <th class="email-head">User</th>
              <th class="downloads-head">Downloads</th>
              <th class="down-size-head">Downloaded</th>
              <th class="login-cnt-head">Logins</th>
              <th class="last-login-head">Last Login</th>
            </tr>
          </thead>
        </table>
      </div>
      <div class="tbl-content">
        <table cellpadding="0" cellspacing="0" border="0">
          <tbody>
            {% for user in users %}
                <tr>
                  <td class="email-col">{{ user.email }}</td>
                  <td class="downloads_col">{{ user.num_downloads }}</td>
                  <td class="down-size-col">{{ "%.2f"|format(user.total_download_size_mb) }}MB</td>
                  <td class="login-cnt-col">{{ user.login_count }}</td>
                  <td class="last-login-col">{{ user.last_signin.strftime('%Y-%m-%d') }}</td>
                </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
</div>


<script>

    $('.close-button').on('click', function () {

          $('.users-overlay').fadeOut('slow');

    });

</script>
<script>

    $('.metrics-button').on('click', function () {

        if ( $('.users-overlay:visible').length == 0 ) {

            $('.users-overlay').fadeIn('slow');

        } else {

            $('.users-overlay').fadeOut('slow');

        };

    });

</script>
<script>

    $('.admin-button').on('click', function () {

        var adminForm = $(this).parent('form');

        if( adminForm[0].checkValidity() ) {

            adminForm.submit();

        } else {

            adminForm[0].reportValidity();
        };

    });

</script>
<script>

    $(document).ready( function () {

        $('.message-box .title-text').fitText(1.25);
        $('.admin-forms h6').fitText(3.0);

    });

</script>
<script>

    $(document).ready(function() {
        $('.user-select').select2({
            tags: false,
            width: '70%',
            placeholder: 'Select user..',
            data: [{% for user in users %}
                   { id: "{{ user.id }}", text: "{{ user.email }}"},
                   {% endfor %}
                  ]
        });
    });

</script>
{% endblock content %}